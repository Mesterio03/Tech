using System;
using System.Collections.Generic;
using System.IO;

namespace DelegatesAndEventsExample
{
    
    public static class CollectionExtensions
    {
        
        public static T GetMax<T>(this IEnumerable<T> collection, Func<T, float> convertToNumber) where T : class
        {
            if (collection == null)
                throw new ArgumentNullException(nameof(collection));
            if (convertToNumber == null)
                throw new ArgumentNullException(nameof(convertToNumber));

            T maxItem = null;               
            float maxValue = float.MinValue; 

            
            foreach (var item in collection)
            {
                
                float value = convertToNumber(item);
                
                if (value > maxValue)
                {
                    maxValue = value;
                    maxItem = item;
                }
            }

            
            return maxItem;
        }
    }

    
    public class FileSearcher
    {
        
        public event EventHandler<FileArgs> FileFound;

        
        public void Search(string directoryPath)
        {
            if (string.IsNullOrEmpty(directoryPath))
                throw new ArgumentNullException(nameof(directoryPath));

            
            var files = Directory.GetFiles(directoryPath);

            
            foreach (var file in files)
            {
                
                var args = new FileArgs(file);
                
                OnFileFound(args);

                
                if (args.Cancel)
                {
                    Console.WriteLine("Поиск остановлен по запросу обработчика.");
                    break;
                }
            }
        }

        
        protected virtual void OnFileFound(FileArgs e)
        {
            FileFound?.Invoke(this, e);
        }
    }

    
    public class FileArgs : EventArgs
    {
        public string FileName { get; } 
        public bool Cancel { get; set; } 
        public FileArgs(string fileName)
        {
            FileName = fileName;
            Cancel = false; 
        }
    }

    
    public class Person
    {
        public string Name { get; set; }
        public int Age { get; set; }
    }

    class Program
    {
        static void Main()
        {
            
            Console.WriteLine("Поиск максимума в коллекции людей:");

            
            var people = new List<Person>
            {
                new Person { Name = "Иван", Age = 27 },
                new Person { Name = "Анастасия", Age = 19 },
                new Person { Name = "Антон", Age = 41 }
            };

            
            var oldestPerson = people.GetMax(p => p.Age);
            Console.WriteLine($"Самый старший: {oldestPerson.Name}, возраст: {oldestPerson.Age}");

            
            Console.WriteLine("\nНачинаем поиск файлов...");

            var searcher = new FileSearcher();

            
            searcher.FileFound += (sender, args) =>
            {
                Console.WriteLine($"Найден файл: {args.FileName}");

                
                if (Path.GetFileName(args.FileName).Equals("123.rtf", StringComparison.OrdinalIgnoreCase))
                {
                    Console.WriteLine("Обнаружен файл '123.rtf', прекращаем поиск...");
                    args.Cancel = true; 
                }
            };

            
            string folderPath = @"D:\123\321"; 

            try
            {
                searcher.Search(folderPath);
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Ошибка при поиске файлов: {ex.Message}");
            }

            Console.WriteLine("Работа завершена.");
        }
    }
}
